# Linux - 用户和权限

[TOC]

# 一、用户

## 1.1 root 用户

无论是Windows、MacOS、Linux均采用多用户的管理模式进行权限管理

在Linux系统中，拥有最大权限的账户名为root

root用户拥有最大的系统操作权限，而普通用户在许多地方的权限是受限的



使用普通用户在根目录下创建文件夹，再切换到root用户后继续尝试

![image-20240530155136287](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240530155136287.png)

**普通用户的权限在其HOME目录内是不受限的，一旦除了HOME目录，大多数地方普通用户仅有只读和执行权限，无修改权限**



## 1.2  切换用户 su

**su命令就是用于账户切换的系统命令，来源Switch User**

**语法**

```sh
su [-] [用户名]
```

* -符号是可选的，表示是否在切换用户后加载环境变量，建议带上
* 用户名参数，表示要切换的用户，用户名也可以省略，省略表示切换到root用户
* 切换用户后，通过exit命令退回上一个用户，也可以使用快捷键ctrl+d
* 使用普通用户切换到其他用户需要输入密码
* root用户切换到其他用户不需输入密码可以直接切换



## 1.3 sudo 认证

不建议长期使用root用户，避免带来系统损坏

我们可以使用sudo命令，为普通的命令授权，临时以root身份执行

**语法**

```sh
sudu 其他命令
```

在其他命令之前，带上sudu，即可为这一条命令临时赋予root授权

但是并不是所有的用户，都有权利使用sudu，**需要为普通用户配置sudo认证**

1. 切换到root用户，**执行visudo命令**，会自动通过vi编辑器打开/etc/sudoers

2. 在文件的最后添加下面内容

```sh
zjqlinux ALL=(ALL) NOPASSWD:ALL
```

3. wq保存

4. 切回普通用户执行命令

![image-20240530161707371](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240530161707371.png)



## 1.4 用户/用户组

Linux系统中可以配置多个用户、配置多个用户组、用户可以加入多个用户组中

![image-20240530154509695](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240530154509695.png)

Linux中关于权限的管控级别有两个

* 针对用户的权限控制
* 针对用户组的权限控制

针对某文件，可以控制用户的权限，也可以控制用户组的权限

所以，我们需要学习在Linux中进行用户、用户组管理的基础命令，为后面学习权限控制打下基础

**用户组相关语法**

* **创建用户组**

```sh
groupadd 用户组名
```

```sh
groupadd test
```



* **删除用户组**

```sh
groupdel 用户组名
```

```sh
groupdel test
```



**用户相关语法**

* **创建用户**

```sh
useradd [-g -d] 用户名
```

-g选项指定用户的组，并且此组需要已经存在，如存在同名组，则必须使用-g，不指定-g的时候，会创建同名组并自动加入

-d选项指定用户HOME路径，不指定，则HOME目录默认在/home/用户名



* **删除用户**

```sh
userdel [-r] 用户名
```

-r选项，删除用户的HOME目录，不使用-r，删除用户时HOME目录保留



* **查看用户所属组**

```sh
id [用户名]
```

用户名参数，被查看的用户，如果不提供则查看自身



* **修改用户所属组**

```sh
usermod -aG 用户组 用户名
```

用户组 用户名，将指定的用户加入指定的组



## 1.5 getent命令

使用getent命令，可以查看当前系统中有哪些用户、哪些用户组

**语法**

**查看当前系统中有哪些用户**

```sh
getent passwd
```

共有7份信息，分别是

用户名：密码(x)：用户ID：组ID：描述信息(无用)：HOME目录：执行终端(默认bash)

![image-20240530164039085](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240530164039085.png)

**查看当前系统中有哪些用户组**

```sh
getent group
```

![image-20240530164412658](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240530164412658.png)





# 二、权限



## 2.1 认知权限信息

通过ls -l可以以列表形式查看内容，并显示权限细节

```sh
ls -l
```

![image-20240530170934998](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240530170934998.png)

* 序号1，表示文件、文件夹的权限控制信息
* 序号2，表示文件、文件夹所属用户
* 序号3，表示文件、文件夹所属用户组



**可以解析一下序号1中的权限细节，一共有10个槽位**

![image-20240530171615092](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240530171615092.png)

> 假如用户A访问用户B（不是一个组），要看用户B的其他用户权限的配置中用户A是否拥有
>
> 比如root用户的其他用户权限都没有，所以其他用户并不能操作root用户的东西
>
> ![image-20240530173441148](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240530173441148.png)

例如：drwxr-xr-x，表示

* 第一部分，首字母d表示，这是一个文件夹
* 第二部分，rwx表示所属用户权限，有r、w、x权限
* 第三部分，r-x表示所属用户组权限，有r权限，有x权限，但是没有w权限
* 第四部分，r-x表示其他用户权限，有r权限，有x权限，但是没有w权限



**r、w、x分别代表什么含义**？

针对文件、文件夹的不同，rwx的含义有细微差别

* **r表示读权限**

  r针对文件可以查看文件内容

  r 针对文件夹，可以查看文件夹内容，如ls命令

* **w表示写权限**

  w针对文件表示可以修改此文件

  w针对文件夹可以再文件夹内创建、删除、改名等操作

* **x表示执行权限**

  x针对文件表示可以将文件作为程序执行

  x针对文件夹表示可以更改工作目录到此文件夹，即cd进入



## 2.2 修改权限控制 chmod 命令

使用chmod命令修改文件、文件夹的权限信息

> **注意：只有文件、文件夹的所属用户或root用户可以修改**

**语法**

```sh
chmod [-R] 权限 文件或文件夹
```

* -R选项，对文件夹内的全部内容应用同样的操作



**示例**

u表示user所属用户权限，g表示group组权限，o表示other其他用户权限

* 将文件权限修改为rwxr-x--x

```sh
chmod u=rwx,g=rx,o=x hello.txt
```



* 将文件夹test以及文件夹内全部内容权限设置为rwxr-x--x

```sh
chmod -R u=rwx,g=rx,o=x test
```

**快捷方法**

将hello.txt的权限修改为751

```sh
chmod 751 hello.txt
```

**权限可以用3位数字来表示，第一位数字表示用户权限，第二位表示用户组权限，第三位表示其他用户权限**

* 0，无任何权限，即---
* 1，仅有x权限，即--x
* 2，仅有w权限，即-w-
* 3，有w和x权限，即-wx
* 4，仅有r权限，即r--
* 5，有r和x权限，即r-x
* 6，有r和w权限，即rw-
* 7，有全部权限，即rwx



 

## 2.3 修改权限控制 chown命令

**修改文件或文件夹的所属用户和用户组**

> **普通用户无法修改所属为其他用户或组，所以此命令只适用于root用户执行**

**语法**

```sh
chown [-R] [用户] [:] [用户组] 文件或文件夹
```

* -R选项，同chmod，对文件夹内全部内容应用相同规则
* 用户选项，修改所属用户
* 用户组选项，修改所属用户组
* “:”选项，用于分隔用户和用户组

**示例**

* **将hello.txt所属用户修改为root**

```sh
chown root hello.txt
```

* **将hello.txt所属用户组修改为root**

```sh
chown :root hello.txt,
```

* **将hello.txt所属用户修改为root,用户组修改为zhangjingqi**

```sh
chown root:zhangjingqi hello.txt
```

* **将文件夹test的所属用户修改为root，并对文件夹内全部内容应用同样规则**

```sh
chown -R root test
```













