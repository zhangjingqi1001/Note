# Linux - IP地址、网络传输、进程

[TOC]



# 一、IP地址与主机名

## 1.1 IP地址

**每一台联网的电脑都会有一个地址**，用于和之前计算机进行通讯

IP地址主要有两个版本，V4版本和V6版本（V6很少用）

IPV4版本的格式是：a.b.c.d，其中abdc表示0~255的数字，如192.168.88.101就是一个标准的IP地址

可以通过命令ifconfig查看本机的IP地址

```ifconfig
ifconfig
```

> **ems33表示主网卡，里面的Inet就是我们的IP地址**
>
> lo表示本地回环的网卡
>
> virbro表示是虚拟机专用的网卡

![image-20240604103816432](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240604103816432.png)

****

如果无法使用ifconfig命令，可以运行一下命令进行安装

```sh
yum -y install net-tools
```

除了标准的IP地址外，还有几个特殊的IP：

* 127.0.0.1，此IP用于指代本机
* 0.0.0.0 特殊IP地址
  * 可以用于指代本机
  * 可以在端口绑定中用来确定绑定关系
  * 在一些IP限制中，表示所有IP的意思，如放行规则设置为0.0.0.0，表示允许人与IP访问



## 1.2 主机名

每一台电脑除了对外联络地址（IP地址）以外，也可以有一个主机名

无论是Windows或Linux系统，都可以给系统设置主机名

* **Windows系统主机名**

![image-20240604105403019](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240604105403019.png)

* **Linux系统主机名**

```sh
hostname
```

![image-20240604105303911](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240604105303911.png)



**可以使用如下的命令修改主机名，但是需要root权限**

```sh
hostnamectl set-hostname 主机名
```



## 1.3 域名解析

IP地址是非常难记的，而且我们一直都是通过字符化的地址去访问服务器，很少指定IP地址，较多的情况都会使用域名

> 比如输入www.baidu.com，是百度的地址，我们称之为域名



访问www.baidu.com流程如下所示

![image-20240604110218456](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240604110218456.png)

* **先查看本机的记录，也就是私人地址本**

Windows看：C\Windows\System32\drivers\etc\hosts

Linux看：/etc/hosts

> 我们可以在Windows的配置文件中配置一下，192.168.101.66是我虚拟机的地址
>
> ```sh
> 192.168.101.66 centos
> ```
>
> 当配置上后，就可以在我们电脑通过centos去连接Linux了



* **再联网去DNS服务器**

如114.114.114.114或者8.8.8.8



## 1.4 Linux固定IP地址

当前虚拟机的Linux操作系统的IP地址是通过DHCP服务获取的

> DHCP：动态获取IP地址，即每次重启设备都会获取一次，可能导致IP地址频繁变更



办公电脑IP地址变化无所谓，但是我们要远程连接到Linux系统，如果IP地址经常变化我们这边就需要经常进行适配

除此之外我们在DNS配置了虚拟机的IP地址和主机名映射，如果IP频繁更改，我们也需要频繁更新映射关系



所以当虚拟机的IP地址固定下来后会非常的方便



**配置固定IP需要两个大步骤**

1. **在VMware Workstation（或Fusion）中配置IP地址网关和网段**（IP地址的范围）

打开虚拟网络编辑器

![image-20240604140145608](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240604140145608.png)

找到VMnet8，设置子网IP和子网掩码，设置完成后点击“NAT设置”

> 这个地方子网IP我们设置为了192.168.101.0，表示IP地址的范围是192.168.101.0到192.168.101.254

![image-20240604140626266](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240604140626266.png)

对于网关的设置，比如设置成"192.168.101.2"

> 因为范围是0-254，所以2就可以了

![image-20240604140658302](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240604140658302.png)

2. **在Linux系统中手动修改配置文件，固定IP**

需要编辑这个文件

```sh
vim /etc/sysconfig/network-scripts/ifcfg-ens33
```

![image-20240604141405626](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240604141405626.png)



**当上面的操作完成后，IP地址就变成了一个固定的IP**





# 二、网络传输

1. 使用ping命令检查服务器是否可联通
2. 使用wget命令下载文件
3. 使用curl命令发起网络请求

## 2.1 下载和网络请求

### 2.1.1 ping 命令

可以通过ping命令检查指定的网络服务器是否是可联通状态

**语法**

```sh
ping [-c num] ip或主机名
```

* -c选项 检查的次数num选项，不使用-c选项，将无限次数持续检查
* 参数ip或主机名，被检查的服务器的IP地址或主机名地址

**示例**

如下所示，ping www.baidu.com

下图的结果表示联通，延迟47、37、41、44毫秒左右

![image-20240604144525937](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240604144525937.png)

### 2.1.2 wget 命令

wget是非交互式的文件下载器，可以在命令行内下载网络文件

**语法**

```sh
wget [-b] url
```

* **-b选项，可选，后台下载，会将日志写入到当前工作目录的wget-log文件**

下面的语句可以监控文件的下载

```sh
tail -f wget-log
```



* **参数url，下载链接**



> **注意！无论下载成功还是失败，都会生成要下载的文件**、
>
> Ctrl+c，可以终止对文件的下载



### 2.1.3 curl命令

curl可以发送http网络请求，用于下载文件、获取信息等

```sh
curl [-O] url
```

* -O选项，用于下载文件，当url是下载链接时，可以使用此选项保存文件
* url参数，要发起请求的网络地址



**示例**

* **向cip.cc发起网络请求**

```sh
curl cip.cc
```



![image-20240604153754495](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240604153754495.png)



* 通过curl下载hadoop-3.3.0安装包

```sh
curl -O http://archive.apache.org/dis/hadoop/common/hadoop-3.3.0/handoop-3.3.0.tar.gz
```





## 2.2 端口

端口，是设备和外界通讯交流的出入口。

端口可以分为物理端口和虚拟端口两类



**物理端口**：又称之为接口，是可见的端口，如USB接口、RJ45网口、HDMI端口等

**虚拟端口**：是指计算机内部的端口，是不可见的，是用来操作系统和外部进行交互使用的

![image-20240604165113244](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240604165113244.png)

计算机A想查找计算机B，那么知道计算机的IP地址你就可以找到他

![image-20240604165206262](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240604165206262.png)

计算机A和计算机B都会有太多的程序，比如计算机A中的微信想访问计算机B中的微信，只通过IP地址是不够精确的

因为IP地址只能够代表一台电脑，但是锁定不了电脑里面的某一个程序

![image-20240604165333913](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240604165333913.png)

**IP地址相当于小区的地址，在小区内可以有许多住户（程序），而门牌号（端口）就是各个住户（程序的联系地址）**

Linux系统是一个超大号小区，可以支持65535个端口，这6万个端口分为三类使用

* **公认端口：1~1023**

通常用于一些系统内置或知名程序的预留使用，如SSH服务的22端口，HTTPS服务的443端口，非特殊需要，不要占用这个范围的端口

* **注册端口：1024~49151**（用户自定义）

通常可以随意使用，用于松散的绑定一些程序\服务

* **动态端口：49152~65535**（多用于出口）

通常不会固定绑定程序，而是当程序对外进行网络链接时，用于临时使用

如图中，计算机A的微信连接计算机B的微信，A使用50001即动态端口，临时找一个端口作为出口

计算机B微信使用端口5678，即注册端口，长期绑定次端口等待别人连接

![image-20240607103333178](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240607103333178.png)





* **使用Linux命令查看端口的占用情况**

使用nmap命令

```sh
yum -y install nmap
```

![image-20240607104801509](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240607104801509.png)

**语法**

```sh
nmap 被查看的IP地址
```

可以查看这个IP地址上有哪些端口是对外公开可以连接的

![image-20240607104930146](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240607104930146.png)



* **netstat命令查看指定端口的占用情况**

安装netstat

```sh
yum -y install net-tools
```

**语法**

```sh
netstat -anp | grep 端口号
```

如下图，可以看到当前系统6000端口被程序（进程号7174）占用

其中0.0.0.0:6000，表示端口绑定在0.0.0.0IP地址上，表示允许外部访问

LISTEN表示在监听中

![image-20240607105314652](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240607105314652.png)





# 三、进程管理

程序运行在操作系统中，是被操作系统所管理的

为了管理运行的程序，每一个程序在运行的时候，便被操作系统注册为系统中的一个：进程

并会为每一个进程都分配一个独有的：进程ID（进程号）



**查看进程**

**语法**

```sh
ps [-e -f]
```

* -e选项，显示出全部的进程
* -f选项，以完全格式化的形式展示信息（展示全部信息）

**一般来说，固定用法就是：ps -ef 列出全部进程的全部信息**

从左到右分别是：

* UID：进程所属的用户ID
* PID：进程的进程号ID
* PPID：进程的父ID（启动此进程的其他进程）
* C：此进程的CPU占用率（百分比）
* STIME：进程的启动时间
* TTY：启动此进程的终端序号，如显示“？”，表示非终端启动
* TIME：进程占用CPU的时间
* CMD：进程对应的名称或启动路径或启动命令

![image-20240607111922800](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240607111922800.png)



**使用管道符配合grep过滤查找**

下面的语句，即可精确的找到tail命令的信息

```sh
ps -ef | grep tail
```

* 过滤不仅仅过滤名称，进程号、用户ID等等，都可以被gerp过滤

* 如：ps -ef | grep 30001，过滤带有30001关键字的进程信息（一般指代过滤30001进程号）



**关闭进程**

在Windows系统中，可以通过任务管理器选择进程后，点击结束进程从而关闭它

在Linux中同样可以通过kill命令关闭进程

**语法**

```sh
kill [-9] 进程ID
```

* 选项-9，表示强制关闭进程，不使用此选项会向进程发送信号要求其关闭，但是否关闭看进程自身的处理机制



# 四、主机状态监控

## 4.1 top介绍

可以通过top命令查看CPU、内存的使用情况，类似Windows的任务管理器

> 默认5s刷新一次

**语法**

直接输入top即可，按q或ctrl+c退出

```sh
top [-p -d -c -n -b -i -u]
```

-p 选项：只显示某个进程的信息

-d选项：设置刷新时间，默认是5s

-c选项：显示产生进程的完整命令，默认是进程名

-n选项：指定刷新次数，比如top -n 3 刷新输出3次后退出

-b选项：以非交互非全屏模式运行，以批次的方式执行top，一般配合-n指定输出几次统计信息，将输出重定向到指定文件，比如 top -b -n 3 > /tem/top.tmp

-i选项：不显示任何闲置（idle）或无用（zombie）的进程

-u选项：查找特定用户启动的进程

![image-20240611085026960](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240611085026960.png)

* **第一行**

top表示程序名称

08:53:03表示当前系统时间

up 15min表示启动了15分钟

2 users表示两个用户登录

load表示1/5/15分钟平均负载

> 1分钟平均负载0.61，5分钟平均负载0.83，15分钟平均负载0.50

![image-20240611085315538](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240611085315538.png)



* **第二行**

Tasks：175个进程

2 running：2个进程在运行

203 sleeping：203个进程在睡眠

0 stopped：0个停止进程

0 zombie：0个僵尸进程

![image-20240611090257230](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240611090257230.png)



* **第三行**

> ，CPU相关数据，其实就是把CPU的占用分为多个指标而已

%Cpu（s）：CPU使用率

us：用户CPU使用率

sy：系统CPU使用率

ni：高优先级进程占用CPU时间百分比

id：空闲CPU率

wa：IO等待CPU占有率

hi：CPU硬件中断率

si：CPU软件中断率

st：强制等待占用CPU率

![image-20240611090523817](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240611090523817.png)

* **第四、五行**

Kib Mem：物理内存

Kib Swap：虚拟内存（交换空间）

total：总量

free：空闲

used：使用

buff/cache：buff/cache占用

![image-20240611091003604](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240611091003604.png)



* **剩余进程信息**

PID：进程id

USER：进程所属用户

PR：进程优先级，越小越高

NI：负值表示高优先级，正表示低优先级

VIRT：进程使用虚拟内存，单位KB

RES：进程使用物理内存，单位KB

SHR：进程使用共享内存，单位KB

S：进程状态，S休眠、R运行、Z僵死状态、N负数优先级、I空闲状态

%CPU：进程占用CPU率

%MEM：进程占用内存率

TIME+：进程使用CPU时间总计，单位10毫秒

COMMAND：进程的命令或名称或程序文件路径

![image-20240611091548046](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240611091548046.png)



## 4.2 top交互式选项

当top以交互式运行（非-b选项启动），可以用以下交互式命令进行控制

> 其实就是在交互式的模式下是可以使用一些按键的

![image-20240611100030077](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240611100030077.png)



## 4.3 磁盘信息监控

**语法**

使用df命令，可以查看硬盘的使用情况

```sh
df [-h]
```

选项 -h，表示以更加人性化的单位显示

![image-20240611100607747](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240611100607747.png)



**查看磁盘和CPU具体的一些详细的监控指标**

**语法**

```sh
iostat [-x] [num1] [num2]
```

选项-x，显示更多信息

num1：数字，刷新间隔

num2：数字，刷新几次

> 下图中的Device sda，就是虚拟机的硬盘，有tps设备的每秒传输次数，Kb_read/s每秒读了多少kb，kb_wrtn/s每秒写了多少kb，kB_read总的读取数，kB_wrtn总写出数

![image-20240611101049721](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240611101049721.png)

当添加-x选项后，会有许多新的参数

![image-20240611101433534](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240611101433534.png)

![image-20240611101507619](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240611101507619.png)



## 4.4 网络状态监控

可以使用sar命令查看网络的相关统计

> sar命令非常复杂，这里仅简单用于统计网络

**语法**

```sh
sar -n DEV num1 num2
```

选项-n，查看网络，DEV表示查看网络接口

num1：刷新间隔（不填就查看一次结束）

num2：查看次数，不填表示无限次数

> 其实我们只需要看rxKB /s和txKB/s即可，即下载与上传

![image-20240611103229996](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240611103229996.png)





# 五、环境变量

## 5.1 环境变量作用

在使用which命令的时候，我们知道使用的一系列命令其实本质就是一个个的可执行程序

> 比如cd的命令本体就是/usr/bin/cd这个程序文件

**为何无论当前工作目录在哪里，哪里就能执行/usr/bin/cd这个程序呢**？

其实就是环境变量中PATH这个项目的值帮我们实现的

**环境变量是操作系统在运行的时候，记录的一些关键性信息，用以辅助系统运行**

在Linux系统中执行env命令，即可查看当前系统中记录的环境变量

环境变量是一种KeyValue型结构，即名称和值

> HOME：/home/zjqlinux，用户的HOME路径
>
> USER：zjqlinux，当前的操作用户
>
> PWD：当前的工作路径
>
> 一系列信息，用于辅助系统在运行的时候从环境变量中获取关键信息

![image-20240611110628875](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240611110628875.png)



**专门看一下PATH**

PATH后面所记录的路径其实就是执行程序的搜索路径，并且发现有好几个目录，且通过冒号隔开

> 比如说我们执行cd这个程序的时候，就会在记录的这一系列的目录里面搜索，首先在/usr/local/bin搜有没有cd这个执行程序，如果没有就搜/usr/local/sbin目录，一直这样往下搜，直到搜索到cd这个程序文件

![image-20240611151855307](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240611151855307.png)



## 5.2 $ 符号

在Linux系统中，$符号被用于取“变量”的值

环境变量记录的信息，除了给操作系统自己使用外，如果我们想要取用，也可以使用

取得环境变量的值可以通过语法：$环境变量名 来取得

如：就可以取得PATH这个环境变量的值，并通过echo语句输出出来

```sh
echo $PATH
```

![image-20240611155314067](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240611155314067.png)

或者是：当和其他内容混在一起的时候，可以通过{}来标注取的变量是谁

```sh
echo ${PATH}ABC
```

![image-20240611155443025](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240611155443025.png)



## 5.3 设置环境变量

我们可以自行的设置一些变量，当我们以后自己所开发的程序需要用的时候，就可以从环境变量里面把他取出来，这就相当于我们在自己系统里面记录了一个全局的信息，什么时候想要，什么时候取到就可以了



* **临时设置**

**语法**

```sh
export 变量名=变量值
```

![image-20240611160608555](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240611160608555.png)

当把终端关掉后再打开，就发现拿不到这个值了

![image-20240611160815642](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240611160815642.png)

* **永久生效**
* * 针对当前用户生效，配置在当前用户的~/.bashrc文件中

```sh
vi ~/.bashrc
```

> 但是切换到其他的用户后，就获取不到此变量的值了

![image-20240611161122563](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240611161122563.png)



* * 针对所有用户生效，配置在系统的/etc/profile文件中

  > root用户下执行此操作

  ```sh
  vim /etc/profile
  ```

  ![image-20240611162741231](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240611162741231.png)

* * 并通过语法：source配置文件，进行立刻生效，或重新登录FinalShell生效

![image-20240611161830806](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240611161830806.png)





## 5.4 自定义环境变量PATH

环境变量PATH这个项目里面记录了系统执行命令的搜索路径

这些搜索路径我们也可以自行添加到PATH中



**测试**

* **在当前HOME目录内创建文件夹myenv，在文件夹内创建文件mkhaha**

> 如果一个文件想要以程序的方式执行，还需要给mkhaha加一个执行的权限x

![image-20240612091530494](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240612091530494.png)

* **通过vim编辑器，在mkhaha文件内填入：echo hahahaha**

![image-20240611164305472](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240611164305472.png)

* **完成上述操作后，随意切换工作目录，执行mkhaha命令，发现无法执行**

![image-20240611164607847](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240611164607847.png)



* **修改环境变量**

```sh
vim /etc/profile
```

![image-20240611165002062](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240611165002062.png)

**修改完记得刷新一下**

```sh
source /etc/profile
```

输出一下目前的路径,发现已经有了myenv文件夹

```sh
echo $PATH
```

![image-20240612093159471](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240612093159471.png)



* **执行mkhaha命令**

发现无论在哪里执行“mkhaha”，都会将mkhaha文件中的程序执行

![image-20240612093435819](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20240612093435819.png)

