# 一、介绍

**我们以请求天气为例**

> 请求天气的官网：[WeatherWS Web 服务 (webxml.com.cn)](http://ws.webxml.com.cn/WebServices/WeatherWS.asmx)
>
> 帮助文档：[WeatherWsHelp.pdf (webxml.com.cn)](http://www.webxml.com.cn/files/WeatherWsHelp.pdf)

首先确定使用Hutool工具类发送WebService请求需要几个参数

> 官方网站：[Hutool官方网站](https://apidoc.gitee.com/dromara/hutool/)

![image-20231114093718055](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20231114093718055.png)



**URL地址**：[http://ws.webxml.com.cn/WebServices/WeatherWS.asmx?wsdl](http://ws.webxml.com.cn/WebServices/WeatherWS.asmx?wsdl)

**MethodName方法名**：访问哪个方法就是用哪个

![image-20231114093924742](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20231114093924742.png)

**nameSpaceURI命名空间**：http://WebXml.com.cn/

将targetNamespace的值复制出来就行

![image-20231114093521314](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20231114093521314.png)

**Param参数**：根据方法的不同传入不同的参数

**charset数据格式**：SOAP 请求的默认字符集（charset）是 UTF-8。需要使用其他字符集时，可以通过 `SoapRequest` 对象的 `setCharset` 方法来设置



**send(boolean pretty)执行Webservice请求，即发送SOAP内容**:pretty表示是否格式化

> `true` 参数表示是否对 SOAP 请求和响应进行格式化（即美化、缩进）输出。当传递 `true` 时，SOAP 请求和响应的 XML 数据将会以更可读的形式显示，每个元素都会缩进，使得 XML 结构更清晰易读。
>
> 如果将其改为 `false` 或省略该参数，则输出的 XML 将是紧凑的，没有缩进，适合于传输和存储，但不够易读



# 二、获取国家或地区结果集

**URL地址**：[http://ws.webxml.com.cn/WebServices/WeatherWS.asmx?wsdl](http://ws.webxml.com.cn/WebServices/WeatherWS.asmx?wsdl)

**MethodName方法名**：getRegionDataset

**nameSpaceURI命名空间**：http://WebXml.com.cn/

**Param参数**：不需要方法参数

![image-20231114094445120](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20231114094445120.png)

**响应的数据**：getRegionDatasetResult

**发送请求**

```java
        SoapClient soapClient = SoapClient.create("http://ws.webxml.com.cn/WebServices/WeatherWS.asmx?wsdl")
                //请求方法,命名空间
                .setMethod("getRegionDataset", "http://WebXml.com.cn/");
//                .setParams(map);
//      返回值XML格式
        String sendSoap = soapClient.send(true);
        System.out.println(sendSoap);
```

**返回值sendSoap如下所示,是有getRegionDatasetResult结果集的**，其中有我们国家的地区，有其他国家

```xml
<?xml version="1.0" encoding="utf-8" standalone="no"?>
<soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <soap:Body>
    <getRegionDatasetResponse xmlns="http://WebXml.com.cn/">
      <getRegionDatasetResult>
        <xs:schema xmlns="" xmlns:msdata="urn:schemas-microsoft-com:xml-msdata" xmlns:xs="http://www.w3.org/2001/XMLSchema" id="getRegion">
          <xs:element msdata:IsDataSet="true" msdata:UseCurrentLocale="true" name="getRegion">
            <xs:complexType>
              <xs:choice maxOccurs="unbounded" minOccurs="0">
                <xs:element name="Province">
                  <xs:complexType>
                    <xs:sequence>
                      <xs:element minOccurs="0" name="RegionID" type="xs:string"/>
                      <xs:element minOccurs="0" name="RegionName" type="xs:string"/>
                    </xs:sequence>
                  </xs:complexType>
                </xs:element>
                <xs:element name="Country">
                  <xs:complexType>
                    <xs:sequence>
                      <xs:element minOccurs="0" name="RegionID" type="xs:string"/>
                      <xs:element minOccurs="0" name="RegionName" type="xs:string"/>
                    </xs:sequence>
                  </xs:complexType>
                </xs:element>
              </xs:choice>
            </xs:complexType>
          </xs:element>
        </xs:schema>
        <diffgr:diffgram xmlns:diffgr="urn:schemas-microsoft-com:xml-diffgram-v1" xmlns:msdata="urn:schemas-microsoft-com:xml-msdata">
          <getRegion xmlns="">
            <Province diffgr:id="Province1" msdata:rowOrder="0">
              <RegionID>3113</RegionID>
              <RegionName>黑龙江</RegionName>
            </Province>
            <Province diffgr:id="Province2" msdata:rowOrder="1">
              <RegionID>3114</RegionID>
              <RegionName>吉林</RegionName>
            </Province>
            <Province diffgr:id="Province3" msdata:rowOrder="2">
              <RegionID>3115</RegionID>
              <RegionName>辽宁</RegionName>
            </Province>
              
                .........................................
              
            <Country diffgr:id="Country1" msdata:rowOrder="0">
              <RegionID>3320</RegionID>
              <RegionName>阿尔及利亚</RegionName>
            </Country>
            <Country diffgr:id="Country2" msdata:rowOrder="1">
              <RegionID>3522</RegionID>
              <RegionName>阿根廷</RegionName>
            </Country>
            <Country diffgr:id="Country3" msdata:rowOrder="2">
              <RegionID>3170</RegionID>
              <RegionName>阿曼</RegionName>
            </Country>
              
                  ........................................
              
          </getRegion>
        </diffgr:diffgram>
      </getRegionDatasetResult>
    </getRegionDatasetResponse>
  </soap:Body>
</soap:Envelope>


```



# 三、获取天气预报数据

![image-20231114095336175](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20231114095336175.png)

通过我们查看文档发现参数“theUserID”需要调用getSupportCityDataset 或 getSupportCityString 方法获得，我们可以使用

![image-20231114101708910](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20231114101708910.png)

**发送请求**

```java
    @Test
    public void testWebService2(){
        HashMap<String, Object> map = new HashMap<>();
        map.put("theCityCode", "898");//山东省博兴县
        map.put("theUserID", "");//
        //天气
        SoapClient soapClient = SoapClient.create("http://ws.webxml.com.cn/WebServices/WeatherWS.asmx?wsdl")
                //请求方法,命名空间
                .setMethod("getWeather", "http://WebXml.com.cn/")
                .setParams(map);
//      返回值XML格式
        String sendSoap = soapClient.send(true);
        System.out.println(sendSoap);
    }
```

**输出的sendSoap结果**

```xml
<?xml version="1.0" encoding="utf-8" standalone="no"?>
<soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <soap:Body>
    <getWeatherResponse xmlns="http://WebXml.com.cn/">
      <getWeatherResult>
        <string>山东 滨州</string>
        <string>博兴</string>
        <string>898</string>
        <string>2023/11/14 09:34:27</string>
        <string>今日天气实况：气温：6.7℃；风向/风力：西南风 1级；湿度：38%</string>
        <string>紫外线强度：中等。</string>
        <string>感冒指数：易发，昼夜温差很大，注意预防感冒。
运动指数：较适宜，气温较低，在户外运动请注意增减衣物。
过敏指数：极不易发，无需担心过敏，可放心外出，享受生活。
穿衣指数：较冷，建议着厚外套加毛衣等服装。
洗车指数：较适宜，无雨且风力较小，易保持清洁度。
紫外线指数：中等，涂擦SPF大于15、PA+防晒护肤品。
</string>
        <string>11月14日 晴</string>
        <string>-1℃/11℃</string>
        <string>西南风小于3级</string>
        <string>0.gif</string>
        <string>0.gif</string>
        <string>11月15日 多云转小雨</string>
        <string>2℃/13℃</string>
        <string>西南风小于3级转西北风3-4级</string>
        <string>1.gif</string>
        <string>7.gif</string>
        <string>11月16日 多云转晴</string>
        <string>2℃/10℃</string>
        <string>西北风4-5级转3-4级</string>
        <string>1.gif</string>
        <string>0.gif</string>
        <string>11月17日 晴</string>
        <string>-1℃/9℃</string>
        <string>西北风3-4级转南风小于3级</string>
        <string>0.gif</string>
        <string>0.gif</string>
        <string>11月18日 晴</string>
        <string>1℃/16℃</string>
        <string>西南风转西风小于3级</string>
        <string>0.gif</string>
        <string>0.gif</string>
      </getWeatherResult>
    </getWeatherResponse>
  </soap:Body>
</soap:Envelope>

```





# 四、其他方式请求WebService

https://blog.csdn.net/yangaaaw/article/details/130228477



