# 支付宝支付接入

https://open.alipay.com/



# 一、支付宝接入

打开网站后在下面的地方有需要文档可以查看，然后我们可以看一下”电脑网站支付“

![image-20230905233950847](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20230905233950847.png)

> 电脑网站支付：[支付宝开放平台 (alipay.com)](https://open.alipay.com/api/detail?code=I1080300001000041203)
>
> 这个网站里面的介绍挺全的



**常规接入流程**：创建应用、绑定应用、配置秘钥、上线应用、签约功能

**沙箱接入流程**：直接使用沙箱提供的开发参数，无序进行应用的创建、绑定、上线和签约





## 1.1 常规接入流程

### 1.1.1 创建应用

首先在下面这个页面中找到如下标识并点击[支付宝开放平台 (alipay.com)](https://open.alipay.com/)

![image-20230906000256880](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20230906000256880.png)



之后会有一个接入流程，进行创建

![image-20230906000522412](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20230906000522412.png)

之后进入开放平台控制台[支付宝开放平台 (alipay.com)](https://open.alipay.com/develop/manage)，并选择一个合适的应用（上一步没创建应用的在这里创建也是可以的）

![image-20230906001036451](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20230906001036451.png)

之后点击详情，在这个地方有一个AppId，记下来会在配置文件中进行配置

![image-20230906001242048](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20230906001242048.png)



之后绑定我们的产品能力，之后点击确定

![image-20230906001934954](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20230906001934954.png)

之后便是这个样子

![image-20230906002135310](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20230906002135310.png)



设置一下接口加签方式（密钥/证书）

![image-20230906002424204](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20230906002424204.png)

可以使用密钥，也可以使用证书。我们在这里使用公钥即可

> 只有一些资金支出类接口必须使用证书方式
>
> ![image-20230906002726398](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20230906002726398.png)

![image-20230906002519584](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20230906002519584.png)

到了这一步就需要密钥生成器了，生成后复制到下面即可

而且这个参数很重要，记得记下来写到配置文件中

![image-20230906002845609](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20230906002845609.png)

此时密钥/证书设置完成，下面要设置支付宝网关地址。

支付宝网关地址：开发者调用 OpenAPI 发送 http(s) 请求的目标地址，需配置在AlipayClient中;

这是一个正式的主机地址：https://openapi.alipay.com/gateway.do

![image-20230906003735245](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20230906003735245.png)

应用网关和授权回调地址在单纯的支付业务中是不需要的

应用网关：用于接收生活号信息的

授权回调：用户信息授权、第三方授权

![image-20230906003909188](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20230906003909188.png)

再看一下接口内容加密方式，在我们这里是不用的

![image-20230906004108357](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20230906004108357.png)

![image-20230906004420585](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20230906004420585.png)

然后点击查看，就会看到一个密钥

![image-20230906004431133](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20230906004431133.png)





### 1.1.2 绑定应用

支付宝的开放业务存在**三种角色类型**:

* **开发者角色**:需要开发者账号，一股登录支付宝 开放平台 完成应用开发相关操作
* **商家角色**:需要商家账号，一般登录 商家服务平台 开通支付服务并完成商家经营相关操作.
* **系统服务商(ISV)角色**:需要服务商账号，异步登录 服务商平台 完成代商户签约等操作.三种角色的账号都可通过注册实名认证的支付宝账号登录相应平台完成开通



> 由于应用 (APPID)在支付宝开放平台创建，因此归属于对应开发者账号，如果要**在应用中使用支付和资金等相关的能力，必须完成应用(APPD)同商家账号(PID) 的绑定**，通过账号关联可实现将商家签约的业务能力授权给应用(APPID)，应用即可调用需要商家签约的业务能力(如当面付、转账到支付宝账户等)。



我们首先登录一个商家账号

https://b.alipay.com/page/portal/home

差不多就是下面这个样子

![image-20230906204751979](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20230906204751979.png)

在这里我们要获取一个PID，也就是一个商家账号

![image-20230906204921520](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20230906204921520.png)

如下所示添加绑定即可

![image-20230906205117357](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20230906205117357.png)



### 1.1.3 配置秘钥

这一步其实在 1.1.1中做过了

![image-20230906205338278](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20230906205338278.png)



* **应用公钥public key**：需提供支付宝账号管理者上传到支付宝开放平台

* **应用私钥 private key**：由开发者己保存，需填写到代码中供签名时使用。
* 生成的私钥需妥善保管，避免遗失，不要泄露。

* **秘钥和应用(APPID)**一一对应，即开发者需要为名下的每个应用分别设置密，且不同应用的密钥不能混用.



### 1.1.4 上线应用

在支付宝开放平台https://open.alipay.com/develop/pm/sub/appinfo?appId=2021004115660006

提交审核

![image-20230906210602477](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20230906210602477.png)

![image-20230906210625831](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20230906210625831.png)

如果审核成功后，这里显示的是“已上线”,"已上线"状态下的应用能够在生产环境（正式环境）中调用接口

![](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20230906210957065.png)

### 1.1.5 签约功能

> 有一些功能是必须经过签约才能够使用。签约需要在商家平台进行签约https://b.alipay.com/page/home

应用上线后签约功能、新增功能、删除功能，操作后实时生效。

删除功能时谨慎操作，如果线上已经有用户使用此功能，删除功能后会导致此功能无法使用

**步骤如下所示**

![image-20230906212018935](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20230906212018935.png)

点击下图中的立即开通

![image-20230906212035809](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20230906212035809.png)

之后按照要求填写信息

![image-20230906212135803](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20230906212135803.png)







## 1.2 沙箱接入流程

我们了解了常规接入流程后，发现对普通的学习者是不容易上手的。

但是好人支付宝为我们提供了一个沙箱环境给我们测试使用。真的是个大好人了

https://opendocs.alipay.com/open/02np8i?pathHash=f21715a0

![image-20230906223816693](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20230906223816693.png)

点击下面这个地方就能进入沙箱平台

![image-20230906224046272](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20230906224046272.png)

在控制台出就能看到APPID和商家号。

下图的参数都不用我们申请和注册，沙箱都会为我们提供

![image-20230906224240799](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20230906224240799.png)

各种秘钥在如下地方查看

![image-20230906224616824](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20230906224616824.png)

我们也可以看一下接口内容加密秘钥，对称秘钥

![image-20230906224955645](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20230906224955645.png)

沙箱环境中不需要开通产品的使用权限

![image-20230906225142554](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20230906225142554.png)